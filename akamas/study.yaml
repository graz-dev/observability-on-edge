kind: study
system: edgeobservabilitystack
workflow: collector-footprint-workflow
name: collector-footprint-pareto
description: >
  Minimise OTel Collector working-set memory and CPU on the Civo edge node.
  Objective: weighted composite (60 % memory + 40 % CPU) â€” normalised so
  both signals contribute proportionally regardless of unit difference.
  SLO constraints: zero dropped OR refused spans / logs / metrics at all times.

goal:
  name: minimize_footprint
  objective: minimize
  function:
    formula: ((1 * (collector.working_set_bytes / 1024 / 1024 / 1024)) + (8 * (collector.cpu_millicores / 1000)))
#  constraints:
#    absolute: 
#      - name: no_dropped_spans
#        formula: collector.dropped_spans <= 0

parametersSelection:
  - name: collector.batch_timeout_s
  - name: collector.batch_send_size
  - name: collector.tail_decision_wait_s
  - name: collector.tail_num_traces
  - name: collector.memory_limit_mib
  - name: collector.memory_spike_mib
  - name: collector.gogc
  - name: collector.gomemlimit_mib
  - name: collector.gomaxprocs

parameterConstraints:
  - name: gomemlimit_mib < pod_limit
    formula: collector.gomemlimit_mib < collector.memory_limit_mib


steps:
  - name: baseline
    type: baseline
    values:
      collector.batch_timeout_s: 5
      collector.batch_send_size: 512
      collector.tail_decision_wait_s: 5
      collector.tail_num_traces: 10000
      collector.memory_limit_mib: 400
      collector.memory_spike_mib: 80
      collector.gogc: 80
      collector.gomemlimit_mib: 300
      collector.gomaxprocs: 2
    numberOfTrials: 5

  - name: optimise
    type: optimize
    numberOfExperiments: 500
    maxFailedExperiments: 500
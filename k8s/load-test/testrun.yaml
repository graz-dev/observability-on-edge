apiVersion: k6.io/v1alpha1
kind: TestRun
metadata:
  name: vessel-monitoring
  namespace: observability
spec:
  parallelism: 1
  script:
    configMap:
      name: k6-script
      file: k6-script.js
  runner:
    image: grafana/k6:latest
    imagePullPolicy: IfNotPresent
    # Run on the edge node: k6 simulates vessel sensor traffic originating
    # locally, which is the realistic topology (sensors are co-located with
    # the edge device). Traffic stays within the edge node's network and does
    # NOT cross the satellite link that we simulate failing in Act 3.
    nodeSelector:
      node-role: edge
    env:
      - name: BASE_URL
        value: http://edge-demo-app.observability.svc.cluster.local:8080
    resources:
      requests:
        cpu: "200m"
        memory: "128Mi"
      limits:
        cpu: "500m"
        memory: "256Mi"

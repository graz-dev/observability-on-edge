# OpenTelemetry Collector Builder (OCB) manifest
#
# This file defines a MINIMAL custom OTel Collector distribution that includes
# only the components actually used in this demo.
#
# WHY build a custom distribution?
#   otelcol-contrib (the image we use today) bundles 150+ receivers, processors,
#   exporters and extensions. Most of them are dead code for us â€” they inflate the
#   binary to ~250 MB and waste memory at startup.
#   A trimmed build contains only what we need: ~30 MB binary, ~40 MB at runtime.
#   On a constrained edge node that matters.
#
# HOW to build:
#   1. Install OCB:
#      go install go.opentelemetry.io/collector/cmd/builder@v0.95.0
#   2. Run:
#      builder --config=otelcol-builder.yaml
#   3. Build the Docker image:
#      docker build -f Dockerfile.collector -t edge-otelcol:0.95.0 .
#
# The resulting image can replace otel/opentelemetry-collector-contrib:0.95.0
# in k8s/edge-node/otel-collector-daemonset.yaml.

dist:
  name: otelcol-edge
  description: "Minimal OTel Collector for edge environments"
  output_path: ./dist/otelcol-edge
  version: 0.95.0
  otelcol_version: 0.95.0

extensions:
  - gomod: go.opentelemetry.io/collector/extension/zpagesextension v0.95.0
  - gomod: github.com/open-telemetry/opentelemetry-collector-contrib/extension/healthcheckextension v0.95.0
  - gomod: github.com/open-telemetry/opentelemetry-collector-contrib/extension/storage/filestorage v0.95.0
  - gomod: github.com/open-telemetry/opentelemetry-collector-contrib/extension/pprofextension v0.95.0

receivers:
  # Only OTLP: the app sends OTLP, Fluent Bit sends OTLP. Nothing else needed.
  - gomod: go.opentelemetry.io/collector/receiver/otlpreceiver v0.95.0

processors:
  - gomod: go.opentelemetry.io/collector/processor/memorylimiterprocessor v0.95.0
  - gomod: go.opentelemetry.io/collector/processor/batchprocessor v0.95.0
  - gomod: github.com/open-telemetry/opentelemetry-collector-contrib/processor/resourceprocessor v0.95.0
  # Tail sampling is the core of the edge story
  - gomod: github.com/open-telemetry/opentelemetry-collector-contrib/processor/tailsamplingprocessor v0.95.0
  # Filter processor for future log filtering at collector level
  - gomod: github.com/open-telemetry/opentelemetry-collector-contrib/processor/filterprocessor v0.95.0

exporters:
  # OTLP to Jaeger
  - gomod: go.opentelemetry.io/collector/exporter/otlpexporter v0.95.0
  # Prometheus Remote Write for metrics
  - gomod: github.com/open-telemetry/opentelemetry-collector-contrib/exporter/prometheusremotewriteexporter v0.95.0
  # Loki for logs (uses OTLP HTTP under the hood)
  - gomod: github.com/open-telemetry/opentelemetry-collector-contrib/exporter/lokiexporter v0.95.0

flowchart TB
    subgraph EDGE["ðŸš¢  VESSEL â€” Edge Node  (k3d agent-0)"]
        subgraph APP["edge-demo-app  Â·  Go + OpenTelemetry SDK"]
            E1["/api/sensors/engine\n50â€“80 ms Â· 50% traffic Â· no errors"]
            E2["/api/sensors/navigation\n40â€“60 ms Â· 30% traffic Â· no errors"]
            E3["/api/analytics/diagnostics\n300â€“1500 ms Â· 12% traffic Â· no errors"]
            E4["/api/alerts/system\n80â€“160 ms Â· 8% traffic Â· 20% error rate"]
        end

        FB["Fluent Bit\nLua filter: keep errors OR latency > 200 ms\nâ‰ˆ 86% of logs dropped at source"]

        COL["OTel Collector  (DaemonSet)\nReceiver: OTLP gRPC :4317 / HTTP :4318\nProcessor: tail_sampling  decision_wait=5s\n  â€¢ error-policy: status_code = ERROR\n  â€¢ latency-policy: threshold_ms = 200\n  â†’ drops â‰ˆ 85% of spans\nExtension: file_storage  (bbolt)\n  path: /var/lib/otelcol/file_storage\n  traces + logs queue persist across pod restarts\n  metrics: in-memory queue only"]
    end

    SAT(["ðŸ›°  Satellite Link\nsimulated via iptables DROP rules\nOn outage â†’ data queues to disk, auto-flushes on restore"])

    subgraph HUB["ðŸ¢  SHORE HUB â€” Hub Node  (k3d agent-1)"]
        J["Jaeger  :4317\nTraces â€” gap-fills âœ“\n(any timestamp accepted)"]
        P["Prometheus  :9090\nMetrics â€” gap stays âœ—\n(out-of-order samples dropped)"]
        L["Loki  :3100\nLogs â€” gap-fills âœ“\n(unordered_writes: true)"]
        G["Grafana  :30300\nVessel Operations Â· Edge Pipeline"]
    end

    E1 & E2 & E3 & E4 -->|"OTLP gRPC â€” spans + metrics"| COL
    E1 & E2 & E3 & E4 -.->|"stdout JSON â€” logs"| FB
    FB -->|"OTLP HTTP â€” filtered logs"| COL

    COL -->|"traces Â· file-backed queue"| SAT
    COL -->|"metrics Â· memory queue"| SAT
    COL -->|"logs Â· file-backed queue"| SAT

    SAT -->|"OTLP gRPC"| J
    SAT -->|"remote-write"| P
    SAT -->|"push API"| L
    J & P & L --> G

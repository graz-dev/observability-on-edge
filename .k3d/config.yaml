apiVersion: k3d.io/v1alpha5
kind: Simple
metadata:
  name: edge-observability-demo
servers: 1
agents: 2
image: rancher/k3s:v1.29.0-k3s1
options:
  k3d:
    wait: true
    timeout: "60s"
    disableLoadbalancer: false
  k3s:
    extraArgs:
      - arg: "--disable=traefik"
        nodeFilters:
          - server:*
      - arg: "--disable=servicelb"
        nodeFilters:
          - server:*
    nodeLabels:
      - label: tier=control-plane
        nodeFilters:
          - server:*
      - label: tier=edge
        nodeFilters:
          - agent:*
ports:
  - port: 8080:80
    nodeFilters:
      - loadbalancer
  - port: 8443:443
    nodeFilters:
      - loadbalancer
env:
  - envVar: K3D_FIX_DNS=1
    nodeFilters:
      - server:*
      - agent:*
# Simulate edge hardware constraints
# Note: K3d/Docker resource limits are applied to the container
# CPU: 0.5 cores, Memory: 512MB
# files:
#   - source: /Users/graziano.casto/Documents/GitHub/graz-dev/observability-on-edge
#     destination: /app
#     nodeFilters:
#       - server:*
#       - agent:*

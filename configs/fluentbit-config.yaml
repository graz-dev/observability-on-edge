service:
  flush: 5
  daemon: off
  log_level: info
  parsers_file: parsers.conf
  storage.path: /var/log/fluentbit/storage
  storage.sync: normal
  storage.checksum: off
  storage.max_chunks_up: 128
  storage.backlog.mem_limit: 5M

pipeline:
  inputs:
    - name: tail
      tag: app.logs
      path: /var/log/app/*.log
      parser: json
      db: /var/log/fluentbit/tail.db
      mem_buf_limit: 5MB
      skip_long_lines: on
      refresh_interval: 10
      storage.type: filesystem

  filters:
    # Add resource attributes
    - name: modify
      match: app.logs
      add: cluster edge-observability
      add: namespace observability
      add: deployment edge-demo-app

    # Nest fields for OTLP format
    - name: nest
      match: app.logs
      operation: nest
      wildcard: trace_id
      nest_under: trace_context
      remove_prefix: trace_

  outputs:
    - name: opentelemetry
      match: app.logs
      host: otel-collector.observability.svc.cluster.local
      port: 4318
      metrics_uri: /v1/metrics
      logs_uri: /v1/logs
      traces_uri: /v1/traces
      tls: off
      tls.verify: off
      storage.total_limit_size: 50M
